<div class=" header  pb-6">
    <div class=" container-fluid">
      <div class=" header-body">
        <div class=" row align-items-center py-4">
          <div class=" col-lg-6 col-7">
            <h6 class=" h2  d-inline-block mb-0">
                {{  'vendedores.lista' | translate}}
            </h6>
          </div>
          <div class=" col-lg-6 col-5 text-right">
            <a class=" btn btn-success" href="javascript:void(0)" (click)="addVendedor(modalAdd)"> Nuevo </a>
          </div>
        </div>
      </div>
    </div>
</div>
  
<div class=" container-fluid mt--6">
    <div class=" row">
        <div class=" col">
        <div class=" card">
            <div class=" card-header">
            <!-- <h3 class=" mb-0">Lista de Vendedores</h3> -->
            </div>
            <div class="dataTables_wrapper py-4">
            <div class="row">
                <div class="col-sm-12 col-md-6">
                <div class="dataTables_length" id="datatable_length">
                    <label class="form-control-label"> {{ 'vendedores.tabla.mostrar' | translate}}
                    <select name="datatable_length" aria-controls="datatable" class="form-control form-control-sm" (change)="entriesChange($event)">
                        <option value="10" [selected]="entries == 10">10</option>
                        <option value="25" [selected]="entries == 25">25</option>
                        <option value="50" [selected]="entries == 50">50</option>
                        <option value="-1" [selected]="entries == -1">All</option>
                    </select>
                    {{ 'vendedores.tabla.entradas' | translate}}
                    </label>
                </div>
                </div>
                <div class="col-sm-12 col-md-6">
                <div id="datatable_filter" class="dataTables_filter">
                    <label class="form-control-label"><input type="text" class="form-control form-control-sm" placeholder="{{ 'vendedores.tabla.buscar' | translate}}" aria-controls="datatable" (keyup)="filterTable($event)"/></label>
                </div>
                </div>
            </div>

            <ngx-datatable [messages]="{emptyMessage: 'No se han encontrado resultados!'}"
                class="bootstrap selection-cell expandable" 
                [columnMode]="'force'" [headerHeight]="50" 
                [footerHeight]="50" 
                [rowHeight]="70"
                [limit]="entries != -1 ? entries : undefined" 
                [rows]="temp" [loadingIndicator]="loadingIndicator" 
                (activate)="onActivate($event)">
                <ngx-datatable-column name="Nombre">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tabla.nombre' | translate}}</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Email">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tabla.email' | translate}}</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="telefono">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tabla.telefono' | translate}}</span>
                    </ng-template>
                </ngx-datatable-column>
            
                <ngx-datatable-column name="Acción" >
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tabla.acciones' | translate}}</span>
                    </ng-template>
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                        <span>
                        <button class="btn btn-sm btn-primary" title="{{ 'vendedores.tabla.editar' | translate}}" 
                            (click)='onSelectItem(modalEditVendedor,row)'>
                            <span class="fas fa-user-plus"></span>
                        </button>
                        <!-- <button class="btn btn-sm btn-default" title="{{ 'vendedores.tabla.log' | translate}}"
                            (click)='logLogin(modalLog,row)'>
                            <span class="fas fa-clipboard-list"></span> 
                        </button> -->
                        <button class="btn btn-sm btn-default" title="{{ 'vendedores.tabla.asociar' | translate}}"
                            (click)='asociarCliente(modalCliente,row)'>
                            <span class="fas fa-file-signature"></span> 
                        </button>
                        </span>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
            </div>
        </div>
        </div>
    </div>
</div>


<ng-template #modalCliente >
    <div class=" modal-header">    
        <h5 class="modal-title" >{{ 'vendedores.asociar.lista'| translate }}</h5>
        <button aria-label="Close" class=" close" data-dismiss="modal" type="button" (click)="notificationModal.hide()">
            <span aria-hidden="true"> × </span>
        </button>
    </div>
    <div class=" modal-body  pt-0">
        
        <div class="dataTables_wrapper py-4">
            <div class="row">
                <div class="col-sm-12 col-md-6">
                <div class="dataTables_length" id="datatable_length">
                    <label> {{ 'vendedores.tabla.mostrar' | translate }}
                    <select name="datatable_length" aria-controls="datatable" class="form-control form-control-sm" (change)="entriesChangeCliente($event)">
                        <option value="10" [selected]="entries == 10">10</option>
                        <option value="25" [selected]="entries == 25">25</option>
                        <option value="50" [selected]="entries == 50">50</option>
                        <option value="-1" [selected]="entries == -1">All</option>
                    </select>
                    {{ 'vendedores.tabla.entradas' | translate}}
                    </label>
                </div>
                </div>
                <div class="col-sm-12 col-md-6">
                <div id="datatable_filter" class="dataTables_filter">
                    <label class="form-control-label"><input type="text" class="form-control form-control-sm"  
                        placeholder="{{ 'vendedores.asociar.buscar' | translate}}" 
                        aria-controls="datatable" (keyup)="filterTableCliente($event)"/>
                    </label>
                </div>
                </div>
            </div>

            <ngx-datatable [messages]="{emptyMessage: 'No se han encontrado resultados!'}"
                class="bootstrap selection-cell" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="70" 
                [limit]="entriesCliente != -1 ? entries : undefined" [rows]="clientes" 
                (activate)="onActivateCliente($event)">

                <ngx-datatable-column name="nombre">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.asociar.nombre' | translate}}</span>
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="nrocliente">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.asociar.nrocliente' | translate}}</span>
                    </ng-template>
                </ngx-datatable-column>
                    <ngx-datatable-column name="vendedor">
                        <ng-template let-column="column" ngx-datatable-header-template>
                            <span>{{ 'vendedores.asociar.vendedor' | translate}}</span>
                        </ng-template>
                    </ngx-datatable-column>
                <ngx-datatable-column name="Acción" >
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tabla.acciones' | translate}}</span>
                    </ng-template>
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                        <span>
                            <button *ngIf="row.flag == 1"  class="btn btn-sm btn-default" title="{{ 'vendedores.asociar.desasociar' | translate}}"
                                (click)='desasociar(row)'>
                                <span class="far fa-times-circle"></span> 
                            </button>
                            <button *ngIf="row.flag == 0" class="btn btn-sm btn-success" title="{{ 'vendedores.asociar.asociar' | translate}}"
                                (click)='asociar(row)'>
                                <span class="fas fa-handshake"></span> 
                            </button>
                        </span>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
        </div>

    </div>
    <div class=" modal-footer">
    </div>

</ng-template>
  
<ng-template #modalLog >
    <div class=" modal-header">    
        <h5 class="modal-title" >{{ 'vendedores.tablalog.lista'| translate }}</h5>
        <button aria-label="Close" class=" close" data-dismiss="modal" type="button" (click)="notificationModal.hide()">
            <span aria-hidden="true"> × </span>
        </button>
    </div>
    <div class=" modal-body  pt-0">
        
        <div class="dataTables_wrapper py-4">
            <div class="row">
                <div class="col-sm-12 col-md-6">
                <div class="dataTables_length" id="datatable_length">
                    <label> {{ 'vendedores.tabla.mostrar' | translate }}
                    <select name="datatable_length" aria-controls="datatable" class="form-control form-control-sm" (change)="entriesChangeLog($event)">
                        <option value="10" [selected]="entries == 10">10</option>
                        <option value="25" [selected]="entries == 25">25</option>
                        <option value="50" [selected]="entries == 50">50</option>
                        <option value="-1" [selected]="entries == -1">All</option>
                    </select>
                    {{ 'vendedores.tabla.entradas' | translate}}
                    </label>
                </div>
                </div>
                <div class="col-sm-12 col-md-6">
                <div id="datatable_filter" class="dataTables_filter">
                    <label class="form-control-label"><input type="text" class="form-control form-control-sm" placeholder="" aria-controls="datatable" (keyup)="filterTableLog($event)"/></label>
                </div>
                </div>
            </div>

            <ngx-datatable [messages]="{emptyMessage: 'No se han encontrado resultados!'}"
                class="bootstrap selection-cell" [columnMode]="'force'" 
                [headerHeight]="50" [footerHeight]="50" [rowHeight]="70" 
                [limit]="entriesLog != -1 ? entries : undefined" [rows]="logRow" 
                (activate)="onActivateLog($event)">
                <ngx-datatable-column name="fecha">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span>{{ 'vendedores.tablalog.fecha' | translate}}</span>
                    </ng-template>
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                        {{ row.fecha | date:'medium' }}
                    </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="coords">
                    <ng-template let-column="column" ngx-datatable-header-template>
                        <span> {{ 'vendedores.tablalog.coords' | translate}}</span>
                    </ng-template>
                    <ng-template let-value="value" let-row="row" ngx-datatable-cell-template>
                        <a target="_blank" href="https://www.google.com/maps/@{{row.coords}}">{{row.coords}}</a>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
            </div>

    </div>
    <div class=" modal-footer">
    </div>

</ng-template>


<ng-template #modalAdd >
    <div class=" modal-header">    
        <h5 class="modal-title" > {{ 'vendedores.newForm.titulo' | translate}} </h5>
        <button aria-label="Close" class="close" data-dismiss="modal" type="button" (click)="notificationModal.hide()">
            <span aria-hidden="true"> × </span>
        </button>
    </div>
    <div class=" modal-body  pt-0">
        <form [formGroup]="newFormVendedor" novalidate >
            
            <div class="form-row">
                <div class="form-group col col-md-6">
                    <label class="form-control-label" for="nombre">{{  'vendedores.newForm.nombre' | translate}}  </label>
                    <input type="text" formControlName="nombre" placeholder="{{ 'vendedores.newForm.nombre' | translate}}" name="nombre" class="form-control" id="nombre">
                    <div class="alert  alert-danger" *ngIf="newFormVendedor.get('nombre').hasError('required') && newFormVendedor.get('nombre').touched">  
                        {{  'vendedores.newForm.nombre' | translate}}  es obrigatório
                    </div>  
                </div>      
                <div class="form-group col col-md-6">
                    <label class="form-control-label" for="nroVendedor">{{  'vendedores.newForm.nroVendedor' | translate}}  </label>
                    <input type="text" formControlName="nrovendedor" placeholder="{{ 'vendedores.newForm.nroVendedor' | translate}}" 
                        name="nroVendedor" class="form-control" id="nroVendedor">
                    <div class="alert  alert-danger" *ngIf="newFormVendedor.get('nrovendedor').hasError('required') && newFormVendedor.get('nrovendedor').touched">  
                        {{  'vendedores.newForm.nroVendedor' | translate}}  es obrigatório
                    </div>  
                </div>                           
                <div class="form-group col  ">
                    <label class="form-control-label" for="telefono">{{  'vendedores.newForm.telefono' | translate}}</label>
                    <input type="text" formControlName="telefono" 
                        placeholder="+5492223334444" 
                        name="telefono" class="form-control" id="telefono">
                     <!-- <input type="text" formControlName="telefono"  class="form-control"  [(ngModel)]="mobileToDisplay"
                        ng2TelInput  pattern="[\d]{1}[0-9]{1}[0-9]{2}[0-9]{8}" maxlength=11
                        [ng2TelInputOptions]="{initialCountry: 'AR', onlyCountries: ['AR'], allowDropdown: false}"
                        (ng2TelOutput)="getNumber($event)"
                        (intlTelInputObject)="telInputObject($event)"
                        required /> -->
                    <div class="alert  alert-danger" *ngIf="newFormVendedor.get('telefono').hasError('required') && newFormVendedor.get('telefono').touched">  
                        {{  'vendedores.newForm.telefono' | translate}} es obrigatório
                    </div>  
                </div>                            
            </div>
            <div class="form-row">    
                <div class="form-group col">
                    <label class="form-control-label" for="email">{{ 'vendedores.newForm.email' | translate}}</label>
                    <input type="text" formControlName="email" placeholder="{{ 'vendedores.newForm.email' | translate}}" name="email" class="form-control" id="email">
                    <div class="alert alert-danger" *ngIf="newFormVendedor.get('email').hasError('required') && newFormVendedor.get('email').touched">  
                        {{  'vendedores.newForm.email' | translate}} es obrigatório
                    </div>  
                </div>
            </div>   
              
      </form>
    </div>
    <div class=" modal-footer">
      <button class="btn btn-success" [disabled]='newFormVendedor.invalid' (click)="onCreateVendedor()">{{ 'vendedores.newForm.guardar' | translate}}</button> 
      <button class="btn bg-zeene ml-auto text-white" data-dismiss="modal" type="button" (click)="notificationModal.hide()"> <i class="fa fa-times-circle" ></i>{{  'vendedores.newForm.cancelar' | translate}}</button>
    </div>

</ng-template>


<ng-template #modalEditVendedor >
    <div class=" modal-header">    
        <h5 class="modal-title" > {{ 'vendedores.updateForm.titulo' | translate}}</h5>
        <button aria-label="Close" class=" close" data-dismiss="modal" type="button" (click)="notificationModal.hide()">
            <span aria-hidden="true"> × </span>
        </button>
    </div>
    <div class=" modal-body  pt-0">
        <!-- <form #addForm="ngForm" novalidate> -->
        <form [formGroup]="addForm" novalidate >
            <div class="form-row">
                <div class="form-group col  col-md-6">
                    <label class="form-control-label" for="nombre">{{ 'vendedores.updateForm.nombre' | translate}}</label>
                    <input type="text" formControlName="nombre" placeholder="{{ 'vendedores.updateForm.nombre' | translate}}" name="nombre" class="form-control" id="nombre">
                    <div class="alert  alert-danger" *ngIf="addForm.get('nombre').hasError('required') && addForm.get('nombre').touched">  
                        {{ 'vendedores.updateForm.nombre' | translate}} é obrigatório
                    </div>  
                </div>
                <div class="form-group col col-md-6">
                    <label class="form-control-label" for="nroVendedor">{{  'vendedores.newForm.nroVendedor' | translate}}  </label>
                    <input type="text" formControlName="nrovendedor" placeholder="{{ 'vendedores.newForm.nroVendedor' | translate}}" 
                        name="nroVendedor" class="form-control" id="nroVendedor">
                    <div class="alert  alert-danger" *ngIf="addForm.get('nrovendedor').hasError('required') && addForm.get('nrovendedor').touched">  
                        {{  'vendedores.newForm.nroVendedor' | translate}}  es obrigatório
                    </div>  
                </div>     
                <div class="form-group col">
                    <label class="form-control-label" for="telefono">{{  'vendedores.newForm.telefono' | translate}}</label>
                    <input type="tel" formControlName="telefono"  
                     placeholder="+549-222-333-4444" 
                     name="telefono" class="form-control" id="telefono">
                    <!-- <input type="tel" formControlName="telefono" placeholder="{{ 'vendedores.newForm.telefono' | translate}}" name="telefono" class="form-control" id="telefono"> -->
                    <div class="alert  alert-danger" *ngIf="addForm.get('telefono').hasError('required') && addForm.get('telefono').touched">  
                        {{  'vendedores.newForm.telefono' | translate}} es obrigatório
                    </div>  
                </div>
                
            </div>
            <div class="form-row">    
                <div class="form-group col">
                    <label class="form-control-label" for="email">{{ 'vendedores.updateForm.email' | translate}}</label>
                    <input type="text" formControlName="email" placeholder="{{ 'vendedores.updateForm.email' | translate}}" name="email" class="form-control" id="email">
                    <div class="alert alert-danger" *ngIf="addForm.get('email').hasError('required') && addForm.get('email').touched">  
                        {{ 'vendedores.updateForm.email' | translate}} é obrigatório
                    </div>  
                </div>   
                
            </div>           
      </form>
    </div>
    <div class=" modal-footer">
      <button class="btn btn-success" [disabled]='addForm.invalid' *ngIf="!btnvisibility" (click)="onUpdate()">{{ 'vendedores.updateForm.actaulizar' | translate}}</button> 
      <button class="btn bg-zeene ml-auto text-white" data-dismiss="modal" type="button" (click)="notificationModal.hide()"> <i class="fa fa-times-circle" ></i>{{ 'vendedores.updateForm.cancelar' | translate}}</button>
    </div>

</ng-template>